# 2026-02-08 - Five-Tier Architecture Complete

## Major Accomplishment
Completed documentation and implementation planning for **5-tier AI architecture** for Murphe OI.

## What Was Built

### Architecture Design (Complete)
| Tier | Model | Cost | Role |
|------|-------|------|------|
| Kimi | Kimi K2.5 | **$0** | Front door, 90% of tasks |
| Haiku | Claude Haiku 4.5 | $0.017 | Mechanical tasks |
| Codex | OpenAI Codex | $0.001 | ALL coding |
| Sonnet | Claude Sonnet 4.5 | $0.03 | Research, analysis |
| Opus | Claude Opus 4.5 | $0.089 | Manager, complex decisions |

## Documentation Created

### In `/projects/murphe-o i/`:
1. **architecture.md** - Complete 5-tier specification
2. **tier-strategy.md** - Decision matrix for tier selection
3. **routing-logic.md** - Decision trees and implementation code
4. **decisions/2026-02-08/model-tier-architecture.md** - Decision log

### Updated:
- **SOUL.md** - Already had 5-tier identity
- **README.md** - Already indexed new docs
- **operations/protocols.md** - Added 5-tier spawn protocols
- **operations/communication.md** - Added tier-aware status updates
- **lessons/technical.md** - Refactored to be generic

## Cost Projection
| Before (Opus-only) | After (5-tier) | Savings |
|--------------------|----------------|---------|
| ~$150/month | ~$15-20/month | **87%** |

## Key Principles Documented
1. **Kimi first** - Free tier handles 90%
2. **Script-first** - If deterministic, use script (free)
3. **Silent success** - Scripts output nothing on success
4. **Escalate smartly** - Only to paid models when confidence low
5. **Isolated sessions** - Scheduled work stays clean

## GitHub Repos Status
- **Murphe OI:** https://github.com/EAMJR/murphe-o i
  - Clean, aligned, 5-tier focus
- **Second Coach:** https://github.com/EAMJR/second-coach
  - Business lessons moved, 5-tier documented

## Routing Pattern
```
User → Kimi (free)
    ↓
    ├── Simple? → Handle ($0)
    ├── Mechanical? → Haiku ($0.017)
    ├── Needs Opus? → Opus decides
    │   ├── Code → Codex ($0.001)
    │   ├── Research → Sonnet ($0.03)
    │   └── Manage → Opus ($0.089)
    └── Format → Kimi formats output
```

## Next Steps
- Phase B: Implement spawn functions and classifiers
- Build /skills/sub-agents/ library with tier templates
- Add cost tracking per tier

---
*Documentation complete. Ready for implementation.*
*_Last updated: 2026-02-08 14:45 UTC_*

## Documentation Crawl Progress (Session 2)

Systematically ingesting OpenClaw docs as operating manual. Fetched 21+ pages:

### Core Systems Learned

**Heartbeat System:**
- Default interval: 30m (1h for Anthropic OAuth)
- `HEARTBEAT_OK` ack pattern - stripped if ≤300 chars after
- Active hours: restrict to time windows (e.g., 09:00-22:00)
- Per-agent heartbeats: only listed agents run if any have heartbeat block
- Target options: `last`, `none`, or explicit channel id

**Session Management:**
- DM scopes: `main` (default), `per-peer`, `per-channel-peer`, `per-account-channel-peer`
- **Secure DM mode critical for multi-user**: prevents context leakage between users
- Session keys: `agent::<agentId>::main` (DM), `agent::<agentId>::<channel>::group:<id>` (groups)
- Daily reset: 4:00 AM local time; idle reset optional
- identityLinks: map provider-prefixed peers to canonical identity

**Model Providers:**
- Venice AI recommended for privacy-first (venice/llama-3.3-70b default, venice/claude-opus-45 for hard tasks)
- Full catalog: OpenAI, Anthropic, OpenRouter, Vercel AI Gateway, Cloudflare, Moonshot, Synthetic, OpenCode Zen, Z.AI, GLM, MiniMax, Amazon Bedrock, Qianfan, xAI, Groq, Mistral

**Browser Control:**
- Profiles: `openclaw` (managed, isolated) vs `chrome` (extension relay)
- Extension relay requires OpenClaw Browser Relay extension (badge ON when attached)
- Remote CDP support with auth tokens
- Browserless.io hosted option available

**Nodes System:**
- Companion devices (macOS/iOS/Android/headless) connecting via WebSocket
- Canvas control: present/hide/navigate/eval/snapshot/A2UI
- Camera: list/snap (front/back/both), clip recording
- Screen recording for demos
- Location, SMS (Android)
- Remote node host: `exec` calls forward to node machine
- Approvals: per-node allowlist at `~/.openclaw/exec-approvals.json`

**Elevated Mode:**
- `/elevated on|ask` = host execution with approvals
- `/elevated full` = host execution, auto-approves exec
- Only changes behavior when sandboxed
- Gates: global `tools.elevated` + per-agent `agents.list[].tools.elevated`
- Sender allowlists per provider

**Environment Variables:**
- Precedence: process env → `.env` in cwd → `~/.openclaw/.env` → config env block → shell import
- Config: `env.vars` or `env.OPENROUTER_API_KEY` style
- Substitution: `${VAR_NAME}` in config strings
- Shell env import: `env.shellEnv.enabled` (runs login shell for missing keys)

### Pages Fetched
1. Overview, Getting Started, Multi-Agent, Sub-Agents
2. Channels (WhatsApp, Telegram base)
3. Configuration, Cron Jobs, Sandboxing, FAQ
4. WhatsApp detailed (Baileys), Telegram detailed (grammY), Skills
5. Heartbeat, Model Providers, Session Management
6. Browser, Nodes, Elevated Mode, Setup, Environment

### 404s (will try alternate paths)
- `/concepts/memory` → try `/concepts/session`
- `/canvas` → likely merged elsewhere
- `/tools/eval`, `/help/security` → different paths

### Key Constraints Stored
- **Sub-agents cannot spawn sub-sub-agents** (nested fan-out blocked)
- **Sub-agents get**: AGENTS.md + TOOLS.md only (no SOUL.md/USER.md/HEARTBEAT.md)
- **Max concurrent sub-agents**: 8 default
- **Session target**: isolated sessions for scheduled work, main for continuity
- **Cost optimization**: $1/day target achieved via 5-tier routing

### Implementation Notes for Phase B
- Use `agents.spawn()` with `agentId` matching tier (haiku, codex, sonnet, opus)
- Spawn cost: only pay for what runs
- routing-logic.md contains complete classifier logic
- Script-first: deterministic logic in bash before spawning models

---
*Documentation crawl in progress. 21/30 pages fetched.*
*_Last updated: 2026-02-08 15:06 UTC_*

## Session Completion (16:50 UTC)

### Final Actions
1. **Created MEMORY.md** — Curated long-term memory for session continuity
2. **Added .gitignore** — Prevent future large file commits
3. **Git garbage collection suggested** — .git/objects still ~1.9GB from filter-branch (normal, cleans on next gc)
4. **Phase B blocked** — Waiting on API key funding before tiered spawn implementation

### Repository Status
- **murphe-oi:** All docs updated, commits pushed to master
- **openclaw-core:** MEMORY.md created, .gitignore added, pushed to main
- **second-coach:** MVP complete (separate repo)

### Next Session
When API keys funded:
1. Configure Haiku/Codex/Sonnet/Opus providers in openclaw.json
2. Test tiered spawning
3. Implement Classifier → Router
4. Add cost tracking/observability